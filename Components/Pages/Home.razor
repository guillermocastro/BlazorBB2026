@inject IStringLocalizer<Resources.Resource> L
@inject ICommonService CommonService
@inject IWebService WebService
@inject AuthenticationStateProvider AuthenticationStateProvider
@using Microsoft.AspNetCore.Authorization;
@using Microsoft.AspNetCore.Components.Authorization;
@using Microsoft.AspNetCore.Identity;
@using System.Globalization

@page "/"
<PageTitle>@L["Home"]</PageTitle>
<AuthorizeView>
    <Authorized>
        <div class="container-fluid feature overflow-hidden py-5">
            <div class="container py-5">
                <div class="text-center mx-auto mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 900px;">
                    @if (AnnouncementList!= null)
                    {
                        @foreach (var announcement in AnnouncementList)
                        {
                            @if (@CultureInfo.CurrentCulture.ToString() == "es-ES")
                            {
                                <h4 class="text-primary">Anuncio</h4>
                                <h1 class="display-5 mb-4">@announcement.TitleES</h1>                                
                                <p class="mb-0">
                                    @announcement.DescriptionES
                                </p>
                            }
                            else
                            {
                                <h4 class="text-primary">Announcement</h4>
                                <h1 class="display-5 mb-4">@announcement.TitleEN</h1>
                                <p class="mb-0">
                                    @announcement.DescriptionEN
                                </p>
                            }
                            break;
                        }
                    }
                </div>
            </div>
            <div class="row g-4 justify-content-center text-center mb-5">
                <div class="col-md-6 col-lg-4 col-xl-3 wow fadeInUp" data-wow-delay="0.1s">
                    <div class="text-center p-4">
                        <div class="d-inline-block rounded bg-light p-4 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 32 32"><path fill="#e34663" d="M5 5a3 3 0 0 1 3-3h10.172a3 3 0 0 1 2.12.879l5.83 5.828A3 3 0 0 1 27 10.828V27a3 3 0 0 1-3 3h-7.535c.34-.588.535-1.271.535-2h7a1 1 0 0 0 1-1V12h-5a3 3 0 0 1-3-3V4H8a1 1 0 0 0-1 1v9.416a5 5 0 0 0-2 1.583zm15 5h4.586L19 4.414V9a1 1 0 0 0 1 1m-1 11a1 1 0 1 0-2 0v4a1 1 0 1 0 2 0zm3-5a1 1 0 0 1 1 1v8a1 1 0 1 1-2 0v-8a1 1 0 0 1 1-1M5.5 19.5V19a3.5 3.5 0 1 1 7 0v.5h.5a2.5 2.5 0 0 1 2.5 2.5v6a2.5 2.5 0 0 1-2.5 2.5H5A2.5 2.5 0 0 1 2.5 28v-6A2.5 2.5 0 0 1 5 19.5zm2-.5v.5h3V19a1.5 1.5 0 0 0-3 0m3.5 6a2 2 0 1 0-4 0a2 2 0 0 0 4 0" /></svg>
                        </div>
                        <div class="feature-content">
                            <a href="/Administration" class="h4">Seguridad <i class="fa fa-long-arrow-alt-right"></i></a>
                            <p class="mt-4 mb-0">
                                Gestión de la seguridad. Cuentas y roles.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </Authorized>
    <NotAuthorized>
        <div class="container-fluid feature overflow-hidden py-5">
            <div class="container py-5">
                <div class="text-center mx-auto mb-5 wow fadeInUp" data-wow-delay="0.1s" style="max-width: 900px;">
                    @if (AnnouncementList != null)
                    {
                        @foreach (var announcement in AnnouncementList)
                        {
                            @if (@CultureInfo.CurrentCulture.ToString() == "es-ES")
                            {
                                <h4 class="text-primary">Anuncio</h4>
                                <h1 class="display-5 mb-4">@announcement.TitleES</h1>
                                <p class="mb-0">
                                    @announcement.DescriptionES
                                </p>
                            }
                            else
                            {
                                <h4 class="text-primary">Announcement</h4>
                                <h1 class="display-5 mb-4">@announcement.TitleEN</h1>
                                <p class="mb-0">
                                    @announcement.DescriptionEN
                                </p>
                            }
                            break;
                        }
                    }
                </div>
                <div class="row g-4 justify-content-center text-center mb-5">
                    <!-- Articles begin -->
                    @if (ArticleList!=null)
                    {
                        @foreach (var article in ArticleList.Where(x => x.IsEnabled == true).OrderBy(x => x.ArticleId))
                        {
                            <div class="col-md-6 col-lg-4 col-xl-3 wow fadeInUp" data-wow-delay="0.1s">
                                <div class="text-center p-4">
                                    <div class="d-inline-block rounded bg-light p-4 mb-4">
                                        <ShowAsHtml HtmlContent="@article.Svg" />
                                    </div>
                                    <div class="feature-content">
                                        @if (article.Url == "#")
                                        {
                                            @if (@CultureInfo.CurrentCulture.ToString() == "es-ES")
                                            {
                                                <a class="h4">@article.TitleES </a>
                                                <p class="mt-4 mb-0">
                                                    @article.TextES
                                                </p>
                                            }
                                            else
                                            {
                                                <a class="h4">@article.TitleEN </a>
                                                <p class="mt-4 mb-0">
                                                    @article.TextEN
                                                </p>
                                            }
                                        }
                                        else
                                        {
                                            @if (@CultureInfo.CurrentCulture.ToString() == "es-ES")
                                            {
                                                <a href="@article.Url" class="h4">@article.TitleES <i class="fa fa-long-arrow-alt-right"></i></a>
                                                <p class="mt-4 mb-0">
                                                    @article.TextES
                                                </p>
                                            }
                                            else
                                            {
                                                <a href="@article.Url" class="h4">@article.TitleEN <i class="fa fa-long-arrow-alt-right"></i></a>
                                                <p class="mt-4 mb-0">
                                                    @article.TextEN
                                                </p>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    }
                   
                    <!-- Articles end -->
@*                     <div class="col-12 wow fadeInUp" data-wow-delay="0.1s">
                        <div class="my-3">
                            <a href="/Testimonial" class="btn btn-primary d-inline rounded-pill px-5 py-3">@L["Testimonial"]</a>
                        </div>
                    </div> *@
                </div>
                <div class="row g-5 pt-5" style="margin-top: 6rem;">
                    <div class="col-lg-6 wow fadeInLeft" data-wow-delay="0.1s">
                        <div class="feature-img RotateMoveLeft h-100" style="object-fit: cover;">
                            <img src="img/features-1.png" class="img-fluid w-100 h-100" alt="">
                        </div>
                    </div>
                    <div class="col-lg-6 wow fadeInRight" data-wow-delay="0.1s">
                        @* <h4 class="text-primary">Features</h4> *@
                        @* <h1 class="display-5 mb-4">Push Your Visitors Into Happy Customers</h1>
                        <p class="mb-4">
                            ERP, CRM, MIS, Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, suscipit itaque quaerat dicta porro illum, autem, molestias ut animi ab aspernatur dolorum officia nam dolore. Voluptatibus aliquam earum labore atque.
                        </p> *@
                        <div class="row g-4">
                            <div class="col-6">
                                <div class="d-flex">
                                    <i class="fas fa-newspaper fa-4x text-secondary"></i>
                                    <div class="d-flex flex-column ms-3">
                                        <h2 class="mb-0 fw-bold">12</h2>
                                        <small class="text-dark">@L["Active Projects"]</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="d-flex">
                                    <i class="fas fa-users fa-4x text-secondary"></i>
                                    <div class="d-flex flex-column ms-3">
                                        <h2 class="mb-0 fw-bold">6</h2>
                                        <small class="text-dark">@L["Happy Clients"]</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @* <div class="my-4">
                            <a href="#" class="btn btn-primary rounded-pill py-3 px-5">Read More</a>
                        </div> *@
                    </div>
                </div>
            </div>
        </div>
    <!-- Feature End -->     
    </NotAuthorized>
</AuthorizeView>

@code{
    public System.Security.Principal.IPrincipal User { get; set; }
    public static string CurrentUserName { get; set; }

    private bool isRoleAdmin { get; set; } = false;
    private bool isRoleAccounting { get; set; } = false;

    IEnumerable<Announcement>? AnnouncementList;
    IEnumerable<Article>? ArticleList;

    System.Security.Claims.ClaimsPrincipal CurrentUser;

    protected override async Task OnInitializedAsync()
    {
        var authenticationState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        AnnouncementList = await WebService.GetAnnouncements();

        CurrentUserName = authenticationState.User.Identity.Name;
        isRoleAccounting = await CommonService.IsRoleMember(CurrentUserName, "Accounting");
        isRoleAdmin = await CommonService.IsRoleMember(CurrentUserName, "Admin");
        ArticleList = await WebService.GetArticles();
    }
}
